<% if crumbs.present? %>
  <nav aria-label="Fil d'ariane" class="breadcrumbs-nav" data-controller="breadcrumbs">
    <!-- Version desktop : chemin complet -->
    <div class="breadcrumbs-desktop">
      <% crumbs.each_with_index do |crumb, index| %>
        <% if index > 0 %>
          <i class="fas fa-chevron-right breadcrumbs-separator" aria-hidden="true"></i>
        <% end %>

        <% if index == 0 && crumb[:is_home] && crumb[:path].present? %>
          <%= link_to crumb[:path],
              class: "breadcrumbs-link breadcrumbs-home",
              title: crumb[:name],
              "aria-label": crumb[:name],
              data: { breadcrumbs_target: "link" } do %>
            <i class="fas fa-home" aria-hidden="true"></i>
            <span><%= crumb[:name] %></span>
          <% end %>
        <% elsif crumb[:path].present? %>
          <%= link_to crumb[:name], crumb[:path],
              class: "breadcrumbs-link",
              title: crumb[:name],
              data: { breadcrumbs_target: "link" } %>
        <% else %>
          <span class="breadcrumbs-current" title="<%= crumb[:name] %>" aria-current="page">
            <%= crumb[:name] %>
          </span>
        <% end %>
      <% end %>
    </div>

    <!-- Structured Data pour SEO -->
    <script type="application/ld+json">
      <%= breadcrumbs_structured_data(crumbs, request.original_url) %>
    </script>

    <!-- Version mobile : retour au parent uniquement -->
    <% if crumbs.length > 1 %>
      <% parent = crumbs[-2] %>
      <% if parent && parent[:path].present? %>
        <div class="breadcrumbs-mobile">
          <%= link_to parent[:path], class: "breadcrumbs-back-link" do %>
            <i class="fas fa-arrow-left" aria-hidden="true"></i>
            <span><%= parent[:name] %></span>
          <% end %>
        </div>
      <% end %>
    <% end %>
  </nav>
<% end %>
